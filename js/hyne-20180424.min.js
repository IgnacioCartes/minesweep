!function(s,e){"use strict";s.console.log;var t,i,r,c,o={},u={},a={},h={},n=function(e){if(null===s.document.body)throw new Error("document.body is null");return t=e||{},i={},h.frame=[],(r=this).routine("_START","startscene",[]),this.routine("_END","endscene",[]),this};n.prototype.routine=function(e,n,t){if(0===arguments.length)return this;if(1===arguments.length&&"string"==typeof e)return o[e];o[e]&&s.console.warn("There is a routine named "+e+" already, it will be overwritten.");var i=new d(e,t);return o[e]=i,n&&(h[n]||(h[n]=[]),h[n].push(o[e])),this},n.prototype.service=function(){if(0===arguments.length)return this;var e={};if("object"==typeof arguments[0])e.name=arguments[0].name,e.service=arguments[0].service,e.proto=arguments[0].proto,e.props=arguments[1];else{if("string"!=typeof arguments[0]||"function"!=typeof arguments[1])return 1===arguments.length&&"string"==typeof arguments[0]?u[arguments[0]].fn:(s.console.warn("Bad arguments provided when registering a new service."),this);e.name=arguments[0],e.fn=arguments[1],e.props=arguments[2]}u[e.name]&&s.console.warn("There is a service named "+e.name+" already, it will be overwritten.");var n=new v(e);return(u[e.name]=n).fn},n.prototype.scene=function(e,n){if(0===arguments.length)return this;if(1===arguments.length&&"string"==typeof e)return a[e];a[e]&&s.console.warn("There is a scene named "+e+" already, it will be overwritten.");var t=new f(e,n);return a[e]=t,this},n.prototype.emit=function(e,n){if(!h[e])return s.console.warn("Event "+e+" is not registered! Event will not be emitted."),null;for(var t in h[e]){var i=h[e][t],r=[];for(var o in i.services){var a=i.services[o];"string"!=typeof a&&(a=a.name),r.push(u[a].fn)}n&&r.push(n),c.scene[i.name]&&c.scene[i.name].apply(this,r)}},n.prototype.instance=function(){return r},n.prototype.version=function(){return"0.2"};var v=function(e){if(this.name=e.name,i[e.name]={},this.fn=new e.service(Object.assign({},i[e.name],t),e.props),this.props=e.props,e.proto)for(var n in e.proto)Object.getPrototypeOf(r)[n]=e.proto[n];return this},d=function(e,n){return this.name=e,this.services=n,this};d.prototype.appendService=function(e){};var f=function(e,n){return this.name=e,this.scene=n,this};f.prototype.set=function(e){return c&&r.emit("endscene"),c===this||(c=this,r.emit("startscene",e)),this},f.prototype.remove=function(){return this!==c?delete a[this.name]:s.console.warn("Cannot remove the current live scene!"),this},(n.Service=n.Service||{}).Interval={name:"__interval__",service:function(e,n){this.animation=null,this.ticks=0,this.frame=function(e){this.emit("frame"),e.ticks++,e.animation&&s.requestAnimationFrame(e.frame.bind(this,e))}},proto:{run:function(){var e=u.__interval__.fn;return e.animation=s.requestAnimationFrame(e.frame.bind(this,e)),this},stop:function(){var e=u.__interval__.fn;return e.animation&&(s.cancelAnimationFrame(e.animation),e.animation=null),this}}},n.Service.Scope={name:"__scope__",service:function(e,n){}},s.HYNE=n}(window),function(r,e,o){"use strict";if(!r.HYNE)throw new Error("HYNE Core must be loaded before modules!");var n={name:"__display__",service:function(n,e){for(var t in n.width=e.width||320,n.height=e.height||240,n.appendTo=e.appendTo||r.document.body,n.layers=e.layers||["buffer"],n.interval=e.interval,n.canvas={main:a(n.width,n.height),layers:{}},n.contexts={},n.layers){var i=n.layers[t];n.canvas.layers[i]=a(n.width,n.height),n.contexts[i]=n.canvas.layers[i].context}n.mobile&&(n.canvas.main.canvas.style.width=r.innerWidth.toString()+"px",n.canvas.main.canvas.style.height=r.innerHeight.toString()+"px"),function(e,n){var t;if("string"==typeof e){if((t=r.document.getElementById(e))===o)return r.console.error('Element "'+e+'" was not found!')}else"object"==typeof e&&"function"==typeof e.appendChild&&e.nodeType&&(t=e);t.appendChild(n)}(n.appendTo,n.canvas.main.canvas),this.context=n.contexts,this.clear=function(){var e;(e=n.canvas.main).context.clearRect(0,0,e.width,e.height)},this.copy=function(){!function(e,n){for(var t in n){var i=n[t];e.context.drawImage(i.canvas,0,0),i.context.clearRect(0,0,i.width,i.height)}}(n.canvas.main,n.canvas.layers)}}};function a(e,n){var t={};return t.canvas=r.document.createElement("canvas"),t.width=e,t.canvas.width=e,t.height=n,t.canvas.height=n,t.context=t.canvas.getContext("2d"),t}r.HYNE.Service||(r.HYNE.Service={}),r.HYNE.Service.Display=n}(window,window.HYNE),function(s,e,n){"use strict";if(!s.HYNE)throw new Error("HYNE Core must be loaded before modules!");var t={name:"__mouse__",service:function(e,n){var t={x:0,y:0,down:!1},i={x:0,y:0},r={x:1,y:1},o=!1,a=!1;n.touch||e.mobile?(r.x=n.width/s.innerWidth,r.y=n.height/s.innerHeight,s.document.addEventListener("touchstart",function(e){t.x=e.touches[0].clientX*r.x,t.y=e.touches[0].clientY*r.y,t.down=!0,o=!0}),s.document.addEventListener("touchmove",function(e){t.down&&(i.x+=t.x-e.touches[0].clientX*r.x,i.y+=t.y-e.touches[0].clientY*r.y),t.x=e.touches[0].clientX*r.x,t.y=e.touches[0].clientY*r.y}),s.document.addEventListener("touchend",function(e){t.down=!1,a=!0,i={x:0,y:0}})):(s.document.addEventListener("mousedown",function(e){t.x=e.x,t.y=e.y,t.down=!0,o=!0}),s.document.addEventListener("mousemove",function(e){t.down&&(i.x+=t.x-e.x,i.y+=t.y-e.y),t.x=e.x,t.y=e.y}),s.document.addEventListener("mouseup",function(e){t.x=e.x,t.y=e.y,t.down=!1,a=!0,i={x:0,y:0}})),this.get=function(){return t},this.sweep=function(){var e={x:i.x,y:i.y};return i.x=0,i.y=0,e},this.click=function(){var e=o;return o=!1,e},this.release=function(){var e=a;return a=!1,e}}};s.HYNE.Service||(s.HYNE.Service={}),s.HYNE.Service.Mouse=t}(window,window.HYNE);